---
# ============================================================================
# SPEC METADATA - This entire frontmatter section contains the spec metadata
# ============================================================================

# === IDENTIFICATION ===
id: 995e1fda # Unique identifier (never changes)
title: Configure Shared Libraries Infrastructure
type: task
category: infrastructure

# === HIERARCHY ===
parent: 'E01-F03'
children: []
epic: 'E01'
domain: infrastructure

# === WORKFLOW ===
status: completed
priority: high
assignee: ''
reviewer: ''

# === TRACKING ===
created: '2025-08-28'
updated: '2025-09-01'
due_date: ''
estimated_hours: 3
actual_hours: 2

# === DEPENDENCIES ===
dependencies:
  - 'E01-F03-T01'
blocks:
  - 'E01-F03-T03'
  - 'E01-F03-T04'
  - 'E01-F03-T05'
related: []
pull_requests: []
commits:
  - text: 'feat(libs): generate all shared libraries structure'
    hash: '5bae2d8'
  - text: 'feat(utils): add utility functions for math, date, and validation'
    hash: 'a35798d'
  - text: 'feat(domain): add trading domain service and market constants'
    hash: 'd880cc6'
  - text: 'fix(domain): resolve TypeScript build issues'
    hash: '6156255'
context_file: '[context.md](./context.md)'
worktree: 'E01-F03-T02-confiture-shared-libraries-infrastructure'
files:
  - tsconfig.base.json
  - libs/**/project.json
  - libs/**/src/index.ts
  - libs/shared/interfaces/src/lib/*.interface.ts
  - libs/shared/types/src/lib/*.types.ts
  - libs/shared/utils/src/lib/*.utils.ts
  - libs/domain/trading/src/lib/trading-domain.service.ts
github_issue:
  number: 66
  link: 'https://github.com/ddoachi/jts/issues/66'
  status: 'open'

# === METADATA ===
tags:
  - libraries
  - shared
  - domain
  - infrastructure
  - ddd
effort: medium
risk: low
---

# Task T02: Configure Shared Libraries Infrastructure

## Overview

Create the complete shared library structure following Domain-Driven Design principles, including shared utilities, domain logic, infrastructure components, and broker integrations. Configure TypeScript path mappings for clean imports across the monorepo.

## Acceptance Criteria

- [x] All shared libraries created with proper structure
- [x] TypeScript path mappings configured for `@jts/*` imports
- [x] Domain libraries implement core business logic
- [x] Infrastructure libraries provide technical utilities
- [x] Broker libraries ready for integration implementations
- [x] All libraries have proper barrel exports

## Technical Details

### 1. Library Structure

```
libs/
├── shared/
│   ├── dto/           # Data Transfer Objects
│   ├── interfaces/    # TypeScript Interfaces
│   ├── types/         # Type Definitions
│   ├── utils/         # Utility Functions
│   ├── constants/     # Application Constants
│   └── config/        # Configuration Utilities
├── domain/
│   ├── trading/       # Trading Domain Logic
│   ├── market-data/   # Market Data Domain
│   ├── portfolio/     # Portfolio Domain
│   ├── risk/          # Risk Management Domain
│   └── strategy/      # Strategy Domain
├── infrastructure/
│   ├── database/      # Database Utilities
│   ├── messaging/     # Kafka/Redis Utilities
│   ├── http/          # HTTP Client Utilities
│   ├── logging/       # Logging Infrastructure
│   └── monitoring/    # Monitoring Utilities
└── brokers/
    ├── creon/         # Creon API Integration
    ├── kis/           # KIS API Integration
    ├── binance/       # Binance API Integration
    └── upbit/         # Upbit API Integration
```

### 2. Generate Libraries

```bash
# Shared libraries
nx g @nx/js:lib shared-dto --directory=shared/dto --tags=scope:shared
nx g @nx/js:lib shared-interfaces --directory=shared/interfaces --tags=scope:shared
nx g @nx/js:lib shared-types --directory=shared/types --tags=scope:shared
nx g @nx/js:lib shared-utils --directory=shared/utils --tags=scope:shared
nx g @nx/js:lib shared-constants --directory=shared/constants --tags=scope:shared
nx g @nx/js:lib shared-config --directory=shared/config --tags=scope:shared

# Domain libraries
nx g @nx/js:lib domain-trading --directory=domain/trading --tags=scope:domain
nx g @nx/js:lib domain-market-data --directory=domain/market-data --tags=scope:domain
nx g @nx/js:lib domain-portfolio --directory=domain/portfolio --tags=scope:domain
nx g @nx/js:lib domain-risk --directory=domain/risk --tags=scope:domain
nx g @nx/js:lib domain-strategy --directory=domain/strategy --tags=scope:domain

# Infrastructure libraries
nx g @nx/js:lib infrastructure-database --directory=infrastructure/database --tags=scope:infrastructure
nx g @nx/js:lib infrastructure-messaging --directory=infrastructure/messaging --tags=scope:infrastructure
nx g @nx/js:lib infrastructure-http --directory=infrastructure/http --tags=scope:infrastructure
nx g @nx/js:lib infrastructure-logging --directory=infrastructure/logging --tags=scope:infrastructure
nx g @nx/js:lib infrastructure-monitoring --directory=infrastructure/monitoring --tags=scope:infrastructure

# Broker libraries
nx g @nx/js:lib brokers-creon --directory=brokers/creon --tags=scope:brokers
nx g @nx/js:lib brokers-kis --directory=brokers/kis --tags=scope:brokers
nx g @nx/js:lib brokers-binance --directory=brokers/binance --tags=scope:brokers
nx g @nx/js:lib brokers-upbit --directory=brokers/upbit --tags=scope:brokers
```

### 3. TypeScript Path Mappings

```json
// tsconfig.base.json
{
  "compilerOptions": {
    "paths": {
      "@jts/shared/dto": ["libs/shared/dto/src/index.ts"],
      "@jts/shared/interfaces": ["libs/shared/interfaces/src/index.ts"],
      "@jts/shared/types": ["libs/shared/types/src/index.ts"],
      "@jts/shared/utils": ["libs/shared/utils/src/index.ts"],
      "@jts/shared/constants": ["libs/shared/constants/src/index.ts"],
      "@jts/shared/config": ["libs/shared/config/src/index.ts"],
      "@jts/domain/trading": ["libs/domain/trading/src/index.ts"],
      "@jts/domain/market-data": ["libs/domain/market-data/src/index.ts"],
      "@jts/domain/portfolio": ["libs/domain/portfolio/src/index.ts"],
      "@jts/domain/risk": ["libs/domain/risk/src/index.ts"],
      "@jts/domain/strategy": ["libs/domain/strategy/src/index.ts"],
      "@jts/infrastructure/database": ["libs/infrastructure/database/src/index.ts"],
      "@jts/infrastructure/messaging": ["libs/infrastructure/messaging/src/index.ts"],
      "@jts/infrastructure/http": ["libs/infrastructure/http/src/index.ts"],
      "@jts/infrastructure/logging": ["libs/infrastructure/logging/src/index.ts"],
      "@jts/infrastructure/monitoring": ["libs/infrastructure/monitoring/src/index.ts"],
      "@jts/brokers/creon": ["libs/brokers/creon/src/index.ts"],
      "@jts/brokers/kis": ["libs/brokers/kis/src/index.ts"],
      "@jts/brokers/binance": ["libs/brokers/binance/src/index.ts"],
      "@jts/brokers/upbit": ["libs/brokers/upbit/src/index.ts"]
    }
  }
}
```

### 4. Sample Library Implementation

```typescript
// libs/shared/interfaces/src/lib/broker.interface.ts
export interface IBrokerService {
  connect(): Promise<void>;
  disconnect(): Promise<void>;
  isConnected(): boolean;
  getMarketData(symbol: string): Promise<MarketDataDto>;
  submitOrder(order: OrderDto): Promise<OrderResult>;
}

// libs/domain/trading/src/lib/trading.service.ts
export class TradingDomainService {
  calculatePosition(price: number, quantity: number): Position {
    // Domain logic here
  }
}
```

## Implementation Steps

1. **Generate all libraries** (45 min)
   - Run generation commands for each library
   - Verify library structure
   - Set proper tags for dependency boundaries

2. **Configure path mappings** (30 min)
   - Update tsconfig.base.json
   - Verify imports work correctly
   - Test cross-library imports

3. **Implement base interfaces** (45 min)
   - Create core interfaces in shared/interfaces
   - Add DTOs to shared/dto
   - Define types in shared/types

4. **Add utility functions** (30 min)
   - Math utilities for calculations
   - Date/time utilities
   - Validation utilities

5. **Set up barrel exports** (30 min)
   - Configure index.ts for each library
   - Export all public APIs
   - Document usage patterns

## Testing

```bash
# Build all libraries
nx run-many --target=build --projects=libs/*

# Test import resolution
nx g @nx/workspace:move --project=shared-dto --dry-run

# Verify dependency graph
nx graph --focus=libs/*

# Check circular dependencies
nx lint
```

## Success Metrics

- All libraries build without errors
- Path mappings resolve correctly
- No circular dependencies detected
- Clear separation of concerns between library types

## Notes

- Follow DDD principles for domain libraries
- Keep shared libraries generic and reusable
- Infrastructure libraries should be framework-agnostic where possible
- Broker libraries will contain adapter implementations
