---
# ============================================================================
# SPEC METADATA - This entire frontmatter section contains the spec metadata
# ============================================================================

# === IDENTIFICATION ===
id: 0768281a # Unique identifier (never changes)
title: Node.js and Yarn Environment Setup
type: task

# === HIERARCHY ===
parent: 'E01-F02'
children: []
epic: 'E01'
domain: infrastructure

# === WORKFLOW ===
status: completed
priority: high

# === TRACKING ===
created: '2025-08-27'
updated: '2025-08-27'
due_date: ''
estimated_hours: 2
actual_hours: 0

# === DEPENDENCIES ===
files:
  - scripts/build/install-node-yarn.sh
  - scripts/build/install-node-yarn-linux.sh
  - scripts/build/install-node-yarn-windows.ps1
  - configs/environment/package.json.template
  - configs/environment/.yarnrc.yml
  - configs/environment/gitignore.template

# === METADATA ===
tags:
  - nodejs
  - yarn
  - package-manager
  - setup
effort: small
risk: low
---

# Node.js and Yarn Environment Setup

## Overview

Install and configure Node.js 20 LTS and Yarn 4 (Berry) as the foundation for the JTS development environment. This task establishes the runtime and package management system for all TypeScript/NestJS microservices.

## Acceptance Criteria

- [ ] Node.js 20 LTS installed on Linux and Windows (WSL2)
- [ ] Yarn 4 (Berry) configured as primary package manager
- [ ] Corepack enabled for Yarn management
- [ ] Package.json with workspace configuration
- [ ] [[[`.yarnrc.yml`](../../../../.yarnrc.yml)](../../../../.yarnrc.yml)](../../../../.yarnrc.yml) with project settings
- [ ] Installation scripts for both platforms
- [ ] Yarn workspace structure initialized
- [ ] Git ignore patterns for Yarn

## Related Specs

**Blocks:**

- [E01-F02-T02](../E01-F02-T02/spec.md)
- [E01-F02-T03](../E01-F02-T03/spec.md)
- [E01-F02-T04](../E01-F02-T04/spec.md)
- [E01-F02-T05](../E01-F02-T05/spec.md)
- [E01-F02-T06](../E01-F02-T06/spec.md)

## Technical Approach

### Installation Scripts

**Linux Installation** (`scripts/build/install-node-yarn-linux.sh`):

```bash
#!/bin/bash
# Install Node.js 20 LTS
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs

# Enable Corepack for Yarn
corepack enable

# Install Yarn 4 (Berry)
yarn set version stable

# Verify installations
node --version
yarn --version
```

**Windows Installation** (`scripts/build/install-node-yarn-windows.ps1`):

```powershell
# Install Node.js via Chocolatey
choco install nodejs-lts -y

# Enable Corepack
corepack enable

# Set Yarn to stable version
corepack prepare yarn@stable --activate

# Verify installations
node --version
yarn --version
```

### Yarn Configuration

**[[[`.yarnrc.yml`](../../../../.yarnrc.yml)](../../../../.yarnrc.yml)](../../../../.yarnrc.yml)**:

```yaml
nodeLinker: node-modules
enableGlobalCache: false
npmRegistryServer: 'https://registry.npmjs.org'

# Workspace settings
nmMode: hardlinks-local
compressionLevel: mixed

# Plugin configuration
plugins:
  - path: .yarn/plugins/@yarnpkg/plugin-workspace-tools.cjs
    spec: '@yarnpkg/plugin-workspace-tools'
```

### Package.json Setup

```json
{
  "name": "jts-monorepo",
  "version": "1.0.0",
  "private": true,
  "workspaces": ["apps/*", "libs/*"],
  "packageManager": "yarn@4.0.0",
  "engines": {
    "node": ">=20.0.0",
    "yarn": ">=4.0.0"
  },
  "scripts": {
    "setup": "yarn install && yarn prepare",
    "prepare": "husky install"
  }
}
```

## Implementation Steps

1. **Platform Detection** (30 min)
   - Create unified setup script
   - Detect OS and route to appropriate installer
   - Handle WSL2 detection on Windows

2. **Node.js Installation** (30 min)
   - Install Node.js 20 LTS
   - Configure npm registry
   - Set up global npm config

3. **Yarn 4 Setup** (30 min)
   - Enable Corepack
   - Install Yarn Berry
   - Configure [[[`.yarnrc.yml`](../../../../.yarnrc.yml)](../../../../.yarnrc.yml)](../../../../.yarnrc.yml)

4. **Workspace Configuration** (30 min)
   - Initialize monorepo structure
   - Configure workspaces in package.json
   - Set up Yarn plugins

## Deliverables

- `scripts/build/install-node-yarn.sh` - Unified installation script
- `scripts/build/install-node-yarn-linux.sh` - Linux-specific installer
- `scripts/build/install-node-yarn-windows.ps1` - Windows PowerShell installer
- `configs/environment/.yarnrc.yml` - Yarn configuration
- `configs/environment/package.json.template` - Root package configuration template
- `configs/environment/gitignore.template` - Git ignore patterns for Yarn 4
- Installation verification checklist

## Testing Plan

- Test installation on fresh Ubuntu 22.04
- Test installation on Windows 11 with WSL2
- Verify Node.js version is 20.x
- Verify Yarn version is 4.x
- Test workspace resolution
- Verify package installation works

## Notes

- Yarn 4 uses Plug'n'Play by default, but we use node-modules for compatibility
- Corepack is the official way to manage Yarn versions
- This task must be completed before any other development tasks
